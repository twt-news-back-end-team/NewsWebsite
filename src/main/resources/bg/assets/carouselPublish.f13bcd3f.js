import{_ as x,r as D,E as L,o as V,c as C,a as i,t as h,b as l,w as r,n as S,d as m,p as E,e as P}from "./index.eccd65ea.js";import{E as T,a as q}from "./el-button.7769491b.js";import{E as M,a as R,b as U}from "./el-radio.3b4ace62.js";import{E as F}from "./el-input.afff1cb1.js";import{E as o,u as H,a as _,g as B}from "./user.06bfe2a8.js";const k={data(){return{photoHide:!1,pageTitle:"\u8F6E\u64AD\u56FE\u53D1\u5E03",uploadLoading:!1,id:"",title:"",articleId:"",time:"",summary:"",carousel:[[],[],[],[]],dialogVisible:!1,dialogImageUrl:"",fileList:[],imageId:0}},mounted(){this.dateShow()},created(){window.addEventListener("beforeunload", e=>this.beforeunloadFn(e)),this.dateFormat(),this.getCarousel(),this.setInitData()},beforeDestroy(){window.removeEventListener("beforeunload", e=>this.beforeunloadFn(e)),this.dataDestroy()},beforeRouteLeave(e, s, a){this.id||localStorage.setItem("carouselPublishData",JSON.stringify(this.$data)),a()},watch:{$route(){this.setInitData(),this.getCarousel()}},methods:{beforeunloadFn(){this.id||localStorage.setItem("carouselPublishData",JSON.stringify(this.$data))},setInitData(){if(console.log(this.$route.query),this.$route.query.id)this.id=parseInt(this.$route.query.id)||"",this.imageId=this.$route.query.imageId||0,this.articleId=this.$route.query.articleId||"",this.summary=this.$route.query.summary||"",this.title=this.$route.query.title||"",this.pageTitle=parseInt(this.$route.query.id)?"\u8F6E\u64AD\u56FE\u7F16\u8F91":"\u8F6E\u64AD\u56FE\u53D1\u5E03";else{const e=localStorage.getItem("carouselPublishData");e&&(Object.assign(this.$data,JSON.parse(e)),localStorage.removeItem("carouselPublishData"))}},confirm(){if(!this.title){o.warning("\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u6807\u9898");return}if(!this.articleId){o.warning("\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u5173\u8054\u7684\u6587\u7AE0ID");return}if(!this.id){o.warning("\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u4F4D\u7F6E");return}if(!this.summary){o.warning("\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u6458\u8981");return}if(this.fileList.length===0&&this.imageId===0){o.warning("\u8BF7\u6DFB\u52A0\u4E3B\u56FE");return}if(this.uploadLoading=!0,this.imageId===0){let e=new FormData;e.append("img",this.fileList[0].raw),H(e).then(({code:s,message:a,result:c})=>{s===0?(this.imageId=c,this.photoHide=!1,this.updateCarousel(!0)):(o.error(a),this.uploadLoading=!1)}).catch(()=>{o.error("\u53D1\u5E03\u5931\u8D25"),this.uploadLoading=!1})}else this.updateCarousel(!1)},updateCarousel(e){_({id:this.id,articleId:parseInt(this.articleId),title:this.title,imageId:this.imageId,summary:this.summary,createDate:this.time}).then(({code:s,message:a})=>{s===0?parseInt(this.$route.query.id)&&parseInt(this.$route.query.id)!==this.id?_({id:parseInt(this.$route.query.id),articleId:parseInt(this.carousel[this.id-1].articleId),title:this.carousel[this.id-1].title,imageId:this.carousel[this.id-1].imageId,summary:this.carousel[this.id-1].summary,createDate:this.carousel[this.id-1].createDate}).then(()=>{this.empty(),this.getCarousel(),this.uploadLoading=!1,e?o.success("\u4E0A\u4F20\u6210\u529F"):(o.success("\u7F16\u8F91\u6210\u529F"),this.$router.push("/home/carouselManage"))}):(this.empty(),this.getCarousel(),this.uploadLoading=!1,e?o.success("\u4E0A\u4F20\u6210\u529F"):(o.success("\u7F16\u8F91\u6210\u529F"),this.$router.push("/home/carouselManage"))):(o.error(a),this.uploadLoading=!1)})},empty(){this.id="",this.title="",this.articleId="",this.summary="",this.fileList=[],this.imageId=0,localStorage.removeItem("carouselPublishData")},fileChange(e, s){this.fileList=[e],this.photoHide=!0},fileRemove(){this.photoHide=!1},handleRemove(e, s){console.log(e,s)},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getCarousel(){B().then(({code:e,result:s})=>{e===0&&(this.carousel=s,this.carousel.sort((a, c)=>a.id-c.id))})},dataDestroy(){this.timer&&clearInterval(this.timer)},dateShow(){this.timer=setInterval(()=>{this.dateFormat()},1e3)},dateFormat(){let e=new Date,s=e.getFullYear(),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,c=e.getDate()<10?"0"+e.getDate():e.getDate(),t=e.getHours()<10?"0"+e.getHours():e.getHours(),u=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),g=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();this.time=s+"-"+a+"-"+c+" "+t+":"+u+":"+g}}},d= e=>(E("data-v-5d137bf0"),e=e(),P(),e),N={class:"carouselPublish"},O={class:"title"},z={class:"flexLine"},G=d(()=>i("p",{class:"tagText"},"\u6807\u9898\uFF1A",-1)),J={class:"flexLine"},j=d(()=>i("p",{class:"tagText"},"\u6587\u7AE0ID\uFF1A",-1)),Y={class:"flexLine"},A=d(()=>i("p",{class:"tagText"},"\u53D1\u5E03\u65E5\u671F\uFF1A",-1)),K={class:"tagText"},Q={class:"flexLine"},W=d(()=>i("p",{class:"tagText"},"\u8F6E\u64AD\u56FE\u4F4D\u7F6E\uFF1A",-1)),X={class:"flexRow"},Z=d(()=>i("p",{class:"tagText"},"\u6458\u8981\uFF1A",-1)),$={class:"flexLine alignTop"},ee=d(()=>i("p",{class:"tagText"},"\u6DFB\u52A0\u4E3B\u56FE\uFF1A",-1)),te=d(()=>i("p",{class:"tagText marginLeft"},"\uFF08\u5EFA\u8BAE\u6BD4\u4F8B\u4E3A4:3\uFF0C\u5C3A\u5BF8\u5927\u4E8E1600*1200\uFF09",-1)),se={class:"actionBar"},ie=["src"];function le(e, s, a, c, t, u){const g=F,p=M,I=R,y=D("Plus"),w=L,b=U,f=T,v=q;return V(),C("div",N,[i("p",O,h(t.pageTitle),1),i("div",z,[G,l(g,{class:"flexGrow",modelValue:t.title,"onUpdate:modelValue":s[0]||(s[0]= n=>t.title=n),maxlength:"50",placeholder:"\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u6807\u9898","show-word-limit":"",type:"text"},null,8,["modelValue"])]),i("div",J,[j,l(g,{class:"flexGrow",modelValue:t.articleId,"onUpdate:modelValue":s[1]||(s[1]= n=>t.articleId=n),placeholder:"\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u5173\u8054\u7684\u6587\u7AE0ID",type:"text"},null,8,["modelValue"])]),i("div",Y,[A,i("p",K,h(t.time),1)]),i("div",Q,[W,l(I,{modelValue:t.id,"onUpdate:modelValue":s[2]||(s[2]= n=>t.id=n)},{default:r(()=>[l(p,{label:1},{default:r(()=>[m("\u7B2C\u4E00\u5F20\uFF08"+h(!t.carousel[0].title||t.carousel[0].title==="0"?"\u7A7A":t.carousel[0].title)+"\uFF09",1)]),_:1}),l(p,{label:2},{default:r(()=>[m("\u7B2C\u4E8C\u5F20\uFF08"+h(!t.carousel[1].title||t.carousel[1].title==="0"?"\u7A7A":t.carousel[1].title)+"\uFF09",1)]),_:1}),l(p,{label:3},{default:r(()=>[m("\u7B2C\u4E09\u5F20\uFF08"+h(!t.carousel[2].title||t.carousel[2].title==="0"?"\u7A7A":t.carousel[2].title)+"\uFF09",1)]),_:1}),l(p,{label:4},{default:r(()=>[m("\u7B2C\u56DB\u5F20\uFF08"+h(!t.carousel[3].title||t.carousel[3].title==="0"?"\u7A7A":t.carousel[3].title)+"\uFF09",1)]),_:1})]),_:1},8,["modelValue"])]),i("div",X,[Z,l(g,{class:"rowTextarea",modelValue:t.summary,"onUpdate:modelValue":s[3]||(s[3]= n=>t.summary=n),placeholder:"\u8BF7\u8F93\u5165\u8F6E\u64AD\u56FE\u6458\u8981",maxlength:"100","show-word-limit":"",autosize:{minRows:2,maxRows:6},type:"textarea",resize:"none"},null,8,["modelValue"])]),i("div",$,[ee,l(b,{class:S({"hide-upload-btn":t.photoHide}),limit:1,"file-list":t.fileList,accept:"image/*","auto-upload":!1,"list-type":"picture-card","on-preview":u.handlePictureCardPreview,"on-change":u.fileChange,"on-remove":u.fileRemove},{default:r(()=>[l(w,null,{default:r(()=>[l(y)]),_:1})]),_:1},8,["class","file-list","on-preview","on-change","on-remove"]),te]),i("div",se,[l(f,{class:"confirmBtn margin50",onClick:u.confirm,loading:t.uploadLoading},{default:r(()=>[m("\u53D1\u5E03")]),_:1},8,["onClick","loading"]),l(f,{class:"cancelBtn margin50",onClick:u.empty,disabled:t.uploadLoading},{default:r(()=>[m("\u6E05\u7A7A")]),_:1},8,["onClick","disabled"])]),l(v,{modelValue:t.dialogVisible,"onUpdate:modelValue":s[4]||(s[4]= n=>t.dialogVisible=n)},{default:r(()=>[i("img",{"w-full":"",src:t.dialogImageUrl,alt:"Preview Image"},null,8,ie)]),_:1},8,["modelValue"])])}var de=x(k,[["render",le],["__scopeId","data-v-5d137bf0"]]);export{de as default};
